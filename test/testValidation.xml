<?xml version="1.0" encoding="UTF-8"?>
<tests>
    <test>
        <description>Array with one string</description>
        <matlab>{'foo'}</matlab>
        <schema>{ "type": "object" }</schema>
        <json>["foo"]</json>
        <errors>{'' 'does not match type object' '[array]'}</errors>
    </test>
    <test>
        <description>Row vector with NaNs</description>
        <matlab>[NaN 1]</matlab>
        <schema>
            { "type": "array",
              "items": [
                { "type": "number" },
                { "type": "null"}]
            }
        </schema>
        <json>[null,1]</json>
        <errors>
            {'/1' 'does not match type number' 'NaN'}
            {'/2' 'does not match type null' '1'}
        </errors>
    </test>
    <test>
        <description>Foo1</description>
        <matlab>struct('foo', 1)</matlab>
        <schema>
            {
                "type": "object",
                "required": ["bar"]
            }
        </schema>
        <json>{"foo":1}</json>
        <errors>{'' 'is missing required field bar' '{object}'}</errors>
    </test>
    <test>
        <description>Foo2</description>
        <matlab>[1 2]</matlab>
        <schema>
            {
                "type": "object"
            }
        </schema>
        <json>[1, 2]</json>
        <errors>{'' 'does not match type object' '1  2'}</errors>
    </test>
    <test>
        <description>Foo3</description>
        <matlab>'foo'</matlab>
        <schema>
            {
                "type": "number"
            }</schema>
        <json>"foo"</json>
        <errors>{'' 'does not match type number' 'foo'}</errors>
    </test>
    <test>
        <description>Foo4</description>
        <matlab>true</matlab>
        <schema>
            {
                "type": "number"
            }
        </schema>
        <json>true</json>
        <errors>{'' 'does not match type number' 'true'}</errors>
    </test>
    <test>
        <description>Foo4</description>
        <matlab>{'foo'}</matlab>
        <schema>
            {
                "type": "object"
            }
        </schema>
        <json>["foo"]</json>
        <errors>{'' 'does not match type object' '[array]'}</errors>
    </test>
    <test readme="true">
        <description>Pattern</description>
        <matlab>'Hello World'</matlab>
        <schema>
            {
                "type": "string",
                "pattern": "^\\w+$"
            }
        </schema>
        <json>"Hello World"</json>
        <errors>{'' 'does not match pattern ^\w+$' 'Hello World'}</errors>
    </test>
    <test>
        <description>Foo6</description>
        <matlab>'Hello World'</matlab>
        <schema>
            {
                "type": "string",
                "enum": ["foo", "bar"]
            }
        </schema>
        <json>"Hello World"</json>
        <errors>{'' 'is not contained in enumeration' 'Hello World'}</errors>
    </test>
    <test>
        <description>Foo6</description>
        <matlab>4711</matlab>
        <schema>
            {
                "type": "integer",
                "enum": [1, 2, 3, 4]
            }
        </schema>
        <json>4711</json>
        <errors>{'' 'is not contained in enumeration' '4711'}</errors>
    </test>
    <test>
        <description>External Schema</description>
        <matlab>struct('id', '4711', 'bar', 2)</matlab>
        <schema>
            {
                "$ref": "schema2.json"
            }
        </schema>
        <json>
            {
                "id":"4711",
                "bar":2
            }
        </json>
        <errors>{'/bar' 'does not match type string' '2'}</errors>
    </test>
    <test>
        <description>External Schema</description>
        <matlab>struct('id', '4711', 'bar', 2)</matlab>
        <schema>
            {
                "type": "object",
                "properties": {
                    "bar": {
                        "$ref": "schema2.json#/properties/bar"
                    }
                }
            }
        </schema>
        <json>
            {
                "id":"4711",
                "bar":2
            }
        </json>
        <errors>{'/bar' 'does not match type string' '2'}</errors>
    </test>
    <test>
        <description>Internal Schema</description>
        <matlab>struct('id', '4711', 'bar', 2)</matlab>
        <schema>
            {
                "type": "object",
                "properties": {
                    "id": { "type": "string" },
                    "bar": { "$ref": "#/definitions/bar" }
                },
                "additionalProperties": false,
                "definitions": {
                    "bar": { "type": "string" }
                }
            }
        </schema>
        <json>
            {
                "id": "4711",
                "bar": 2
            }
        </json>
        <errors>{'/bar' 'does not match type string' '2'}</errors>
    </test>
    <test>
        <description>additionalProperties</description>
        <matlab>
            {
                struct('id', '4711', 'bar', 2)
                struct('id', '4711', 'bar', 2, 'foo', 'Hello')
            }
        </matlab>
        <schema>
            {
                "type": "array",
                "items": {
                    "type": "object",
                    "properties": {
                        "id": { "type": "string" },
                        "bar": { "type": "number" }
                    },
                    "additionalProperties": false
                }
            }
        </schema>
        <json>
            [
                {
                    "id":"4711",
                    "bar":2
                },
                {
                    "id":"4711",
                    "bar":2,
                    "foo": "Hello"
                }
            ]
        </json>
        <errors>{'/2' 'contains additional properties' '{object}'}</errors>
    </test>
    <test>
        <description>Invalid Reference</description>
        <matlab>struct('id', '4711', 'bar', 2)</matlab>
        <schema>
            {
                "type": "object",
                "properties": {
                    "id": { "type": "string" },
                    "bar": { "$ref": "#/definitions/BAR" }
                },
                "definitions": {
                    "bar": { }
                }
            }
        </schema>
        <json>
            {
                "id": "4711",
                "bar": 2
            }
        </json>
        <errors>{[] 'Invalid $ref at #/properties/bar -> #/definitions/BAR' ''}</errors>
    </test>
    <test>
        <description>Invalid Reference</description>
        <matlab>struct('id', '4711', 'bar', 2)</matlab>
        <schema>
            {
                "type": "object",
                "properties": {
                    "id": { "type": "string" },
                    "bar": { "$ref": 4711 }
                }
            }
        </schema>
        <json>
            {
                "id": "4711",
                "bar": 2
            }
        </json>
        <errors>{[] 'Invalid $ref at #/properties/bar' ''}</errors>
    </test>
    <test readme="true">
        <description>Cyclic Schema References</description>
        <matlab>struct('id', '4711', 'bar', 2)</matlab>
        <schema>
            {
                "type": "object",
                "properties": {
                    "id": { "type": "string" },
                    "bar": { "$ref": "#/definitions/barType" }
                },
                "additionalProperties": false,
                "definitions": {
                    "barType": { "$ref": "#/properties/bar" }
                }
            }
        </schema>
        <json>
            {
                "id": "4711",
                "bar": 2
            }
        </json>
        <errors>{[] 'Cyclic references #/properties/bar -> #/definitions/barType -> #/properties/bar' ''}</errors>
    </test>
    <test readme="true">
        <description>Format validation on stringify</description>
        <matlab>struct('a', 736330, 'b', 736330.5, 'c', 736330.5, 'd', 'i')</matlab>
        <schema>
            {
                "type": "object",
                "properties": {
                    "a": { "type": "string", "format": "date" },
                    "b": { "$ref": "#/properties/a" },
                    "c": { "type": "string", "format": "date-time" },
                    "d": { "$ref": "#/properties/c" }
                }
            }
        </schema>
        <errors>
            {'/b' 'must be an integer' '736330.5'}
            {'/b' 'does not match type string' '736330.5'}
            {'/d' 'must be a number' 'i'}
        </errors>
    </test>
    <test readme="true">
        <description>Format validation on parse</description>
        <schema>
            {
                "type": "object",
                "properties": {
                    "a": { "type": "string", "format": "date" },
                    "b": { "type": "string", "format": "date" },
                    "c": { "type": "string", "format": "date-time" },
                    "d": { "type": "string", "format": "date-time" }
                }
            }
        </schema>
        <json>
            {
                "a": "2016-01-01",
                "b": "2016-01-01T12:00:00Z",
                "c": "2016-01-01T12:00:00Z",
                "d": "2016-01-01T12:00:00Y"
            }
        </json>
        <errors>
            {'/b' 'is not a valid date' '2016-01-01T12:00:00Z'}
            {'/d' 'is not a valid date-time' '2016-01-01T12:00:00Y'}
        </errors>
    </test>
</tests>
